# routerus Project üåêüöÄ

routerus ‚Äî —ç—Ç–æ –ø—Ä–æ–µ–∫—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è VPN (WireGuard), Shadowsocks –∏ Xray —Å–µ—Ä–≤–∏—Å–∞–º–∏ —á–µ—Ä–µ–∑ Python –∏ Django. –ü—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –∑–∞–≥—Ä—É–∑–∫—É –ª–æ–≥–æ–≤ –≤ Dropbox, –∞ —Ç–∞–∫–∂–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å Promtail/Loki –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è. –í—Å—ë —ç—Ç–æ –¥–µ–ª–∞–µ—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ VPN –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø—Ä–æ—Å—Ç—ã–º –∏ –≥–∏–±–∫–∏–º! üéâ

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ ‚ú®

- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ WireGuard —á–µ—Ä–µ–∑ Python: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º –±–µ–∑ –ø—Ä—è–º–æ–≥–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è `wg-quick` –∏–ª–∏ `.conf` —Ñ–∞–π–ª–æ–≤.
- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞: –í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –±–µ—Ä—É—Ç—Å—è –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è (`.env`), –±–µ–∑ —Ä—É—á–Ω–æ–≥–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥–æ–≤.
- –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –∑–∞–ø—É—Å–∫–∞:  
  –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `start.sh` –∏ `stop.sh` –¥–ª—è –∑–∞–ø—É—Å–∫–∞/–æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –∏–ª–∏ Django management-–∫–æ–º–∞–Ω–¥—ã (`servicestart`, `servicestop`, `servicestatus`, `servicestatus_service`) –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ `manage.py`.
- –ü–µ—Ä–µ–Ω–æ—Å–∏–º–æ—Å—Ç—å: –í–æ–∑–º–æ–∂–µ–Ω –∑–∞–ø—É—Å–∫ –≤ Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞—Ö, –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏.
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:  
  –õ–æ–≥–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ Dropbox, —Å–æ–±–∏—Ä–∞—é—Ç—Å—è Promtail –∏ –∞–Ω–∞–ª–∏–∑–∏—Ä—É—é—Ç—Å—è Loki. –õ–æ–≥–∏ –≤ JSON-—Ñ–æ—Ä–º–∞—Ç–µ, —Å —Ä–æ—Ç–∞—Ü–∏–µ–π.
- –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (Django): –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏, –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π, REST API –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤ ‚Äî –≤—Å—ë –¥–æ—Å—Ç—É–ø–Ω–æ –≤ —É–¥–æ–±–Ω–æ–º –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ üóÇ

.
‚îú‚îÄ‚îÄ app
‚îÇ   ‚îú‚îÄ‚îÄ core
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config.py               # Pydantic –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ logging.py              # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ service_configurator.py # –ï–¥–∏–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π —Å–µ—Ä–≤–∏—Å–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ management
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ commands
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ servicestart.py
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ servicestop.py
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ servicestatus.py
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ servicestatus_service.py
‚îÇ   ‚îú‚îÄ‚îÄ services
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ service_manager.py      # –ö–ª–∞—Å—Å ServiceManager –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ—Ä–≤–∏—Å–∞–º–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ wireguard/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ shadowsocks/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ xray/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ dropbox/
‚îÇ   ‚îú‚îÄ‚îÄ templates
‚îÇ   ‚îî‚îÄ‚îÄ ... (–º–æ–¥–µ–ª–∏, –≤—å—é—Ö–∏, —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã)
‚îú‚îÄ‚îÄ config                          # –î–æ–ø. –∫–æ–Ω—Ñ–∏–≥–∏ (nginx, loki, promtail)
‚îú‚îÄ‚îÄ scripts                         # –°–∫—Ä–∏–ø—Ç—ã start.sh, stop.sh –∏ —Ç.–¥.
‚îî‚îÄ‚îÄ tests                           # –¢–µ—Å—Ç—ã

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ üõ†

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

pip install --upgrade pip
pip install poetry
poetry install --no-dev

### ENV –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ `/opt/routerus/.env` (–∏–ª–∏ –¥—Ä—É–≥–æ–º –ø—É—Ç–∏, —É–∫–∞–∑–∞–Ω–Ω–æ–º –≤ config.py):

DEBUG=False
SECRET_KEY="your-secret-key"
ALLOWED_HOSTS="your_server_ip_or_domain,yoursite.ru,localhost,127.0.0.1"

DB_NAME="wg_manager_db"
DB_USER="wg_user"
DB_PASSWORD="password"
DB_HOST="localhost"
DB_PORT=5432

DROPBOX_ACCESS_TOKEN="your_dropbox_token"
DROPBOX_APP_KEY="your_app_key"
DROPBOX_APP_SECRET="your_app_secret"

SHADOWSOCKS_SERVER="your_server_ip"
SHADOWSOCKS_PORT=8388
SHADOWSOCKS_PASSWORD="strongpassword"
SHADOWSOCKS_METHOD="chacha20-ietf-poly1305"
SHADOWSOCKS_TIMEOUT=300

XRAY_UUID="5db36724-4e3c-4669-8e6d-488d2815dd8a"
# –ò –¥—Ä—É–≥–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è Xray –∏ WireGuard

### –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π

python manage.py migrate

### –ó–∞–ø—É—Å–∫

- –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤:
bash scripts/start.sh

- –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤:
bash scripts/stop.sh

- –ß–µ—Ä–µ–∑ Django-–∫–æ–º–∞–Ω–¥—ã:
python manage.py servicestart
python manage.py servicestop
python manage.py servicestatus
python manage.py servicestatus_service wireguard

### –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

–ó–∞–ø—É—Å—Ç–∏—Ç–µ Django-—Å–µ—Ä–≤–µ—Ä (–Ω–∞–ø—Ä–∏–º–µ—Ä, gunicorn):

gunicorn config.wsgi:application --bind 0.0.0.0:8000

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É:
http://your_server:8000

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ üìù

- –õ–æ–≥–∏ –ø–∏—à—É—Ç—Å—è –≤ /var/log/routerus/app.log (JSON-—Ñ–æ—Ä–º–∞—Ç, —Å —Ä–æ—Ç–∞—Ü–∏–µ–π).
- –õ–æ–≥–∏ –¥—É–±–ª–∏—Ä—É—é—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å.
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Promtail –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –ª–æ–≥–æ–≤ –≤ Loki –¥–ª—è –±–æ–ª–µ–µ —É–¥–æ–±–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞.

## Docker üê≥

–í –ø—Ä–æ–µ–∫—Ç–µ –µ—Å—Ç—å docker-compose.yml. –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤:

docker-compose up --build

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ ‚úÖ

–¢–µ—Å—Ç—ã —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω—ã –≤ –∫–∞—Ç–∞–ª–æ–≥–µ tests. –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤:

python manage.py test

–í –¥–∞–ª—å–Ω–µ–π—à–µ–º –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ –∏ –ª–∏–Ω—Ç–µ—Ä—ã (flake8, black) –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞.

## CI/CD ‚öôÔ∏è

–ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å GitHub Actions –∏–ª–∏ GitLab CI –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–µ–ø–ª–æ—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∫–æ–º–º–∏—Ç–µ.

## –ê–≤—Ç–æ—Ä—ã –∏ –ö–æ–Ω—Ç–∞–∫—Ç—ã ‚úâÔ∏è

–ü–æ–¥–¥–µ—Ä–∂–∫–∞: anfisa.kov@yahoo.com
